<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>ArcGIS城市三维展示测试</title>
    <style>
        html,
        body,
        #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.6/esri/css/main.css">
    <script src="https://js.arcgis.com/4.6/"></script>

    <script>
        require([
            "esri/config",
            "esri/Map",
            "esri/views/MapView",
            "esri/views/SceneView",
            "esri/layers/Layer",
            "esri/layers/FeatureLayer",
            "esri/layers/WMTSLayer",
            "esri/layers/WebTileLayer",
            "esri/layers/SceneLayer",
            "esri/WebMap",
            "esri/widgets/LayerList",
            "dojo/domReady!"
        ], function (esriConfig, Map, MapView, SceneView, Layer, FeatureLayer, WMTSLayer, WebTileLayer, SceneLayer, WebMap, LayerList) {
            esriConfig.portalUrl = "https://gisserver.giscloud/arcgis";
            esriConfig.request.corsEnabledServers.push("gisserver.giscloud:6443");

            esriConfig.request.corsEnabledServers.push("t0.tianditu.com");
            esriConfig.request.corsEnabledServers.push("t1.tianditu.com");
            esriConfig.request.corsEnabledServers.push("t2.tianditu.com");
            esriConfig.request.corsEnabledServers.push("t3.tianditu.com");
            esriConfig.request.corsEnabledServers.push("t4.tianditu.com");
            esriConfig.request.corsEnabledServers.push("t5.tianditu.com");
            esriConfig.request.corsEnabledServers.push("t6.tianditu.com");
            esriConfig.request.corsEnabledServers.push("t7.tianditu.com");
            esriConfig.request.corsEnabledServers.push("t8.tianditu.com");
            esriConfig.request.corsEnabledServers.push("t9.tianditu.com");


            var lods = [
                {"level": 2, "resolution": 0.3515625, "scale": 147748796.52937502},
                {"level": 3, "resolution": 0.17578125, "scale": 73874398.264687508},
                {"level": 4, "resolution": 0.087890625, "scale": 36937199.132343754},
                {"level": 5, "resolution": 0.0439453125, "scale": 18468599.566171877},
                {"level": 6, "resolution": 0.02197265625, "scale": 9234299.7830859385},
                {"level": 7, "resolution": 0.010986328125, "scale": 4617149.8915429693},
                {"level": 8, "resolution": 0.0054931640625, "scale": 2308574.9457714846},
                {"level": 9, "resolution": 0.00274658203125, "scale": 1154287.4728857423},
                {"level": 10, "resolution": 0.001373291015625, "scale": 577143.73644287116},
                {"level": 11, "resolution": 0.0006866455078125, "scale": 288571.86822143558},
                {"level": 12, "resolution": 0.00034332275390625, "scale": 144285.93411071779},
                {"level": 13, "resolution": 0.000171661376953125, "scale": 72142.967055358895},
                {"level": 14, "resolution": 8.58306884765625e-005, "scale": 36071.483527679447},
                {"level": 15, "resolution": 4.291534423828125e-005, "scale": 18035.741763839724},
                {"level": 16, "resolution": 2.1457672119140625e-005, "scale": 9017.8708819198619},
                {"level": 17, "resolution": 1.0728836059570313e-005, "scale": 4508.9354409599309},
                {"level": 18, "resolution": 5.3644180297851563e-006, "scale": 2254.4677204799655}
            ];

            var sceneLayer = new SceneLayer({
                url: "http://gisserver.giscloud:6080/arcgis/rest/services/Hosted/sz_buildings/SceneServer",
                title: "bulidings"
            });

            var map = new Map({
                basemap: "gray",
                // ground: "world-elevation"
            });

            var webMap = new WebMap({
                portalItem: { // autocasts as new PortalItem()
                    // id: "e910787bd7a547f59e75ae6f640862fb"
                    id: "e910787bd7a547f59e75ae6f640862fb"
                }
            });
            var view = new MapView({
                container: "viewDiv",
                map: map,
                zoom: 13,
                center: [114.060168, 22.533403]
            });

            /*  var view = new SceneView({
             container: "viewDiv",
             map: webMap,
             zoom: 13,
             center: [114.060168,22.533403]
             });*/


            //图层加载
            loadFeatureLayer("https://gisserver.giscloud:6443/arcgis/rest/services/SZCity/SZCityComponents/MapServer/1");


            //图层控制组件
            view.when(function () {
                var layerList = new LayerList({
                    view: view
                });
                // Add widget to the top right corner of the view
                view.ui.add(layerList, "top-right");
            });


            function loadFeatureLayer(url) {
                var renderer = {
                    type: "simple",  // autocasts as new SimpleRenderer()
                    symbol: {
                        type: "picture-marker",  // autocasts as new PictureMarkerSymbol()
                        url: "img/component/dljt/lijiaoqiao.png",
                        width: "32px",
                        height: "43px"
                    }
                };

                var featureLayer = new FeatureLayer({
                        url: url,
                        renderer: renderer,
                            /* popupTemplate: { // autocasts as new PopupTemplate()
                             title: "<font color='#008000'>Beverly Hills trees by block",
                             content: [{
                             type: "attachments"
                             }]
                             },*/
                        outFields: ["*"]
                    })
                ;
                //featureLayer.visible = false;

                map.add(featureLayer);
            }


        });
        /*
         var  pictureMarkerSymbol = {
         type: "picture-marker",  // autocasts as new PictureMarkerSymbol()
         url: "https://webapps-cdn.esri.com/Apps/MegaMenu/img/logo.jpg",
         width: "8px",
         height: "8px"
         };*/
    </script>
</head>

<body>
<div id="viewDiv"></div>
</body>
</html>